[global]
repo1-type=s3
repo1-s3-bucket={{ postgresql_aws_bucket }}
repo1-s3-endpoint={{ postgresql_aws_endpoint }}
repo1-s3-region={{ postgresql_aws_region }}
repo1-storage-ca-file={{ postgresql_aws_ca_bundle }}
repo1-path=/pgbackrest
repo1-s3-key={{ postgresql_aws_access_key_id }}
repo1-s3-key-secret={{ postgresql_aws_secret_access_key }}
repo1-s3-uri-style=path

# Retention settings
repo1-retention-full={{ postgresql_retention_full }}
repo1-retention-diff={{ postgresql_retention_diff }}
repo1-retention-archive={{ postgresql_retention_archive }}
repo1-retention-archive-type=full

# Performance and reliability settings
start-fast=y
stop-auto=y
archive-async=y
spool-path=/var/spool/pgbackrest
compress-type=lz4
compress-level=1

# Backup verification and checksums
backup-standby=n
checksum-page=y

# Process settings  
process-max={{ postgresql_backup_process_max }}
archive-push-queue-max=100GiB

# Logging
log-level-console=info
log-level-file=debug
log-path=/var/log/pgbackrest

[{{ postgresql_pgbackrest_stanza }}]
pg1-path=/var/lib/postgresql/{{ postgresql_version }}/main
